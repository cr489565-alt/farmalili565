<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>📜 Historial - Farmacia Lili 📜</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:system-ui,sans-serif;
  background:#66696d;
  color:#50545e;
  line-height:1.6;
  padding-bottom:40px;
}
header{
  background:linear-gradient(90deg,#2563eb,#1e40af);
  color:white;
  padding:22px;
  font-size:24px;
  font-weight:700;
  text-align:center;
  position:relative;
  box-shadow:0 4px 18px rgba(15,23,42,0.12);
}
header img{
  position:absolute; left:12px; top:50%; transform:translateY(-50%);
  width:120px; height:80px; border-radius:12px; border:2px solid rgba(255,255,255,0.2);
}
nav.main-menu{
  display:flex;align-items:center;gap:12px;
  background:#eef6ff;padding:10px 16px;border-bottom:1px solid #dbeafe;
  position:sticky; top:0; z-index:50;
}
.main-menu .menu-link{
  text-decoration:none;padding:8px 12px;border-radius:8px;font-weight:600;color:#0f172a;border:1px solid #2563eb;
}
.main-menu .menu-link.active{background:#2563eb; color:white; border-color: #2563eb;}
#cajero{margin-left:auto;font-weight:700;color:#1e40af;}
#logout{background:#ef4444;color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;}
main{padding:18px;display:flex;flex-direction:column;gap:18px;max-width:1200px;margin:0 auto;}
section.card{background:white;padding:14px;border-radius:12px;box-shadow:0 6px 24px rgba(15,23,42,0.06);border:1px solid rgba(2,6,23,0.03);}
h2{color:#1e3a8a;margin-bottom:8px;}
.table-container{width:100%;overflow:auto;margin-top:8px;border-radius:8px;}
table{width:100%;border-collapse:collapse;font-size:0.95rem;}
th,td{padding:8px;border-bottom:1px solid #e6eef8;text-align:left;}
th{background:#1e40af;color:white;position:sticky;top:0;}
tfoot td{font-weight:700;background:#f1f8ff;text-align:right;}
.small-muted{font-size:0.9rem;color:#64748b;}
.toggle-btn{background:#0ea5e9;color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;margin-top:6px;}
.toggle-btn:hover{opacity:0.95;}
.hidden{display:none;}
.modal{display:none;position:fixed;inset:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center;z-index:200;}
.modal-card{width:520px;background:linear-gradient(180deg,#ffffff,#f0f9ff);border-radius:14px;padding:18px;box-shadow:0 8px 40px rgba(2,6,23,0.3);border:1px solid rgba(30,64,175,0.08);}
.modal-card h3{margin-bottom:10px;color:#1e40af;text-align:center;}
.modal-card label{display:flex;justify-content:space-between;align-items:center;margin:6px 0;}
.modal-card input[type="number"]{width:110px;padding:6px;border-radius:6px;border:1px solid #c7ddff;}
.modal-card .total-row{margin-top:12px;font-weight:700;color:#0f172a;text-align:right;}
.btn-primary{background:#16a34a;color:white;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;margin-top:10px;}
.btn-secondary{background:#ef4444;color:white;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;margin-left:8px;}
.note{font-size:0.9rem;color:#475569;margin-top:8px;}
@media (max-width:720px){
  header img{display:none;}
  .modal-ca
      <td>${v.codigo||'-'}</td>
      <td>${v.cantidad||0}</td>
      <td>${v.folio||'-'}</td>
      <td>${v.doctor||'-'}</td>
      <td>${v.cedula||'-'}</td>
      <td>${v.direccion||'-'}</td>
      <td>${v.receta||'-'}</td>
      <td>${v.lote||'-'}</td>
      <td>${v.fecha||'-'}</td>
      <td>${v.cajero||'-'}</td>
      <td>${v.metodo||'-'}</td>
      <td>${formatDinero(v.subtotal)}</td>`;
    tbody.appendChild(tr);
  });
}

function toggle(id){document.getElementById(id).classList.toggle('hidden');}

// ---------- Historial con contraseña ----------
let historialActivo = false;
const CONTRASENA_HISTORIAL = "1234"; // contraseña fija temporal, puedes ajustar

function verHistorial(){
  const pass = document.getElementById('passCorte').value;
  if(pass === CONTRASENA_HISTORIAL){
    historialActivo = true;
    document.getElementById('inputPassDiv').classList.add('hidden');
    document.getElementById('contenedorCortes').classList.remove('hidden');
    document.getElementById('histPassDiv').textContent = "🔓 Historial desbloqueado";
    document.getElementById('passCorte').value = "";
    renderCortes();
  } else { alert("🔒 Contraseña incorrecta"); }
}

function salirHistorial(){
  historialActivo = false;
  document.getElementById('contenedorCortes').classList.add('hidden');
  document.getElementById('inputPassDiv').classList.remove('hidden');
  document.getElementById('histPassDiv').textContent = "Ingresa contraseña para visualizar el historial.";
  document.getElementById('passCorte').value = "";
}

// ---------- Modal Corte ----------
function abrirModalCorte(){document.getElementById('modalCorte').style.display='flex';}
function cerrarModalCorte(){document.getElementById('modalCorte').style.display='none';}

function finalizarCorte(){
  const billetes = document.querySelectorAll('.billete');
  let totalE = 0;
  billetes.forEach(b=>totalE+=Number(b.value||0)*Number(b.dataset.valor||0));
  const tarjeta = Number(document.getElementById('totalTarjeta').value||0);
  const transferencia = Number(document.getElementById('totalTransferencia').value||0);
  const proveedor = 0;
  const totalGeneral = totalE + tarjeta + transferencia + proveedor;

  const cortes = parseJSON('cortes');
  cortes.push({fecha:new Date().toLocaleString(), cajero:usuarioActivo, efectivo:totalE, tarjeta, transferencia, proveedor, total:totalGeneral});
  setJSON('cortes', cortes);

  const ventas = cargarVentasSincronizadas();
  const ventasCorte = parseJSON('ventasCorte');
  ventas.forEach(v=>ventasCorte.push(...v.items.map(it=>({producto:it.nombre,codigo:it.codigo,cantidad:it.cantidad,folio:v.folio,doctor:v.doctor?.nombre,cedula:v.doctor?.cedula,direccion:v.doctor?.direccion,receta:v.doctor?.folioReceta,lote:it.lote,fecha:v.fecha,cajero:v.cajero,metodo:v.metodo,subtotal:it.cantidad*it.precio}))));
  setJSON('ventasCorte', ventasCorte);

  localStorage.setItem('ventas', JSON.stringify([]));
  localStorage.setItem('ventasFarma1', JSON.stringify([]));

  cerrarModalCorte();
  renderVentas();
  renderCortes();
  renderVentasCorte();
}

// ---------- Inicialización ----------
renderVentas();
renderVentasCorte();
</script>
</body>
</html>

